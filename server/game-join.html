<!DOCTYPE html>
<html>
  <head>
    <title>Rooms</title>
    <style>
      #root {
        text-align: center;
        margin-top: 50px;
      }
    </style>
  <head>
  <body>
    <div id="root">
      <ul id="users"></ul>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      function renderList(items) {
        let ul = document.getElementById('users');

        if (ul) {
          ul.remove();
        }
        ul = document.createElement('ul');
        ul.id = 'users';

        for(const prop in items) {
          const li = document.createElement('li');
          li.textContent = prop;
          ul.appendChild(li);
        }
        const root = document.getElementById('root');
        root.appendChild(ul);
      }
      // 1. volatile events
      //const socket = io({ data: { name: 'Taras' } }); auth???
      //const socket = io({ auth: { roomId, userId } });
      const socket = io({
        auth: (cb) => {
          let roomId = sessionStorage.getItem('roomId');
          let userId = sessionStorage.getItem('userId');
          if (!roomId) {
            roomId = location.pathname.split('/')[2];
            sessionStorage.setItem('roomId', roomId);
          }
          if (!userId) {
            userId = 'user_' + Math.floor(Math.random() * 10000);
            sessionStorage.setItem('userId', userId);
          }
          cb({ roomId, userId });
        },
      });

      socket.on('connect', () => {
        socket.emit('game:join');
      });

      socket.on('game:join', (users) => {
        renderList(users);
      });

      socket.on('game:disconnect', (users) => {
        renderList(users);
      });
    </script>
  </body>
</html>
